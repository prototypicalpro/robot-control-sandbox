(this["webpackJsonpdootcamp-robotics"]=this["webpackJsonpdootcamp-robotics"]||[]).push([[0],{62:function(e,t,n){},91:function(e,t,n){},92:function(e,t,n){},94:function(e,t,n){"use strict";n.r(t);var r=n(3),i=n(1),o=n.n(i),c=n(51),s=n.n(c),a=(n(62),n(63),n(12)),l=n(9);function u(e){var t=e.children,n=e.style,o=e.className,c=i.useState(),s=Object(l.a)(c,2),u=s[0],d=s[1],h=i.useRef(null);return i.useEffect((function(){if(h.current){var e=h.current.getBoundingClientRect();d({width:e.width,height:e.height})}}),[d]),Object(r.jsx)("div",{ref:h,style:Object(a.a)({width:"100%",height:"100%"},n),className:o,children:u?t(u):null})}var d,h,f,m,C=n(35),p=n(2),g=(n(64),n(8)),v=n(26),O=n(38);function y(e,t,n,r,i,o,c){var s=.5*-n+20,a=.5*n-20,l=.5*n-20,u=p.Body.nextGroup(!1),d=p.Composite.create({label:"Car"}),h=p.Bodies.rectangle(e,t,n,r,{collisionFilter:{category:f.CARS,mask:f.WALLS,group:u},density:1e-4,render:{fillStyle:null===c||void 0===c?void 0:c.body}});p.Body.rotate(h,Math.PI);var m=p.Bodies.circle(e+s,t+l,i,{collisionFilter:{category:f.CARS,mask:f.WALLS},friction:o,render:{fillStyle:null===c||void 0===c?void 0:c.wheels}}),C=p.Bodies.circle(e+a,t+l,i,{collisionFilter:{category:f.CARS,mask:f.WALLS},friction:o,render:{fillStyle:null===c||void 0===c?void 0:c.wheels}}),g=p.Constraint.create({bodyB:h,pointB:{x:s,y:l},bodyA:m,stiffness:1,length:0,render:{visible:!1}}),v=p.Constraint.create({bodyB:h,pointB:{x:a,y:l},bodyA:C,stiffness:1,length:0,render:{visible:!1}});return p.Composite.add(d,h),p.Composite.add(d,m),p.Composite.add(d,C),p.Composite.add(d,g),p.Composite.add(d,v),[d,{body:h,wheelBack:m,wheelFront:C}]}(h=d||(d={}))[h.SENSOR_B=p.Common.nextId()]="SENSOR_B",(m=f||(f={}))[m.WALLS=p.Body.nextCategory()]="WALLS",m[m.CARS=p.Body.nextCategory()]="CARS",m[m.SENSOR=p.Body.nextCategory()]="SENSOR";var R=n(54),E=n(24),T=n(25),j=n(36),b=n.n(j),w=function(){function e(t){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[];Object(E.a)(this,e),this.size=void 0,this.initial=void 0,this.curDenque=void 0,this.size=t,this.initial=Object(R.a)(n),this.curDenque=new b.a(n)}return Object(T.a)(e,[{key:"addData",value:function(e){this.curDenque.push(e),this.curDenque.length>=this.size&&this.curDenque.shift()}},{key:"values",value:function(){return this.curDenque.toArray()}},{key:"recent",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0;return this.curDenque.peekAt(this.curDenque.length-e-1)}},{key:"get",value:function(e){return this.curDenque.peekAt(e)}},{key:"reset",value:function(){this.curDenque=new b.a(this.initial)}},{key:"count",value:function(){return this.curDenque.length}}]),e}(),D=function(){function e(t){var n=t.maxTorque,r=t.stuckPowerThresh,i=t.stuckAngularVelocityThresh,o=t.frictionCoef;Object(E.a)(this,e),this.maxTorque=void 0,this.stuckPowerThresh=void 0,this.stuckAngularVelocityThresh=void 0,this.frictionCoef=void 0,this.maxTorque=n,this.stuckPowerThresh=r,this.stuckAngularVelocityThresh=i,this.frictionCoef=o}return Object(T.a)(e,[{key:"step",value:function(e,t,n){var r=t*this.frictionCoef;return(Math.abs(t)>=this.stuckAngularVelocityThresh||Math.abs(n)>=this.stuckPowerThresh)&&(r+=n*this.maxTorque),r*e}}]),e}(),x=n(53),_=n.n(x),S=n(37),I=n.n(S),M=(n(88),n(89),n(90),n(91),"\nclass Controller {\n  constructor() {\n\n  }\n\n  step(sensorDistance, time, delta) {\n    return 1\n  }\n}".trim());function k(e){var t=e.initialCode,n=void 0===t?M:t,o=e.onCodeUpdate,c=e.style,s=void 0===c?{}:c,u=i.useState(n),d=Object(l.a)(u,2),h=d[0],f=d[1],m=i.useRef(),C=i.useState(),p=Object(l.a)(C,2),g=p[0],v=p[1];return i.useEffect((function(){f(n)}),[n]),i.useEffect((function(){if(h!==m.current){var e;m.current=h;try{var t=new(e=Function('"use strict"; '.concat(h,"; return Controller;"))());if(!(t instanceof e))throw new Error("Not a class");if(!(t.step instanceof Function))throw new Error("No step() function on class")}catch(n){return void v(n.toString().split("\n")[0])}v(""),o(e)}}),[h,o]),Object(r.jsxs)("div",{style:Object(a.a)({display:"flex",flexDirection:"column"},s),children:[Object(r.jsx)(_.a,{value:h,onValueChange:f,highlight:function(e){return I.a.highlight(e,I.a.languages.javascript,"javascript")},padding:10,className:"controller-editor-container",preClassName:"controller-editor-highlight"}),Object(r.jsx)("p",{style:{color:"#d4d4d4"},children:g})]})}var L={NO_CONTROLLER:{name:"No Controller",code:"\n// Click to edit, or use the dropdown below to select a template\n// then press play to simulate your controller.\n\nclass Controller {\n  step() {\n    return 1\n  }\n}".trim()},TIME_CONTROLLER:{name:"Dead Reckoning",code:"\nconst DRIVE_TIME = 0; // <-- Change me!\n\nclass Controller {\n  constructor() {\n    this.initialTime = null\n  }\n\n  step({time}) {\n    if (this.initialTime === null)\n      this.initialTime = time\n    const timeHasPassed = time - this.initialTime\n    if (timeHasPassed > DRIVE_TIME) return 0\n    else return 1\n  }\n}".trim()},BANG_BANG_CONTROLLER:{name:"Bang-Bang Controller",code:"\nclass Controller {\n  step({sensorDistance}) {\n    if (sensorDistance > 0) return 1\n    else if (sensorDistance < 0) return -1\n    else return 0\n  }\n}".trim()},P_CONTROLLER:{name:"P Controller",code:"\nconst P_TERM = 0 // <-- Change me!\n\nclass Controller {\n  step({sensorDistance}) {\n    return sensorDistance*P_TERM\n  }\n}".trim()},PI_CONTROLLER:{name:"PI Controller",code:"\nconst P_TERM = 0.003\nconst I_TERM = 0 // <-- Change me!\nconst I_CUTOFF = 0 // <-- Change me!\n\nclass Controller {\n  constructor() {\n    this.integral = 0\n  }\n\n  step({sensorDistance, delta}) {\n    if (Math.abs(sensorDistance) > I_CUTOFF) {\n      this.integral = 0\n    }\n    else {\n      this.integral += sensorDistance*delta\n    }\n\n    return sensorDistance*P_TERM + this.integral*I_TERM\n  }\n}".trim()},PID_CONTROLLER:{name:"PID Controller",code:"\nconst P_TERM = 0.003, I_TERM = 0.001, I_CUTOFF = 20, D_TERM = 0 // <-- Change me!\n\nclass Controller {\n  constructor() { this.integral = 0, this.prevDistance = null }\n\n  step({sensorDistance, delta}) {\n    if (this.prevDistance === null) this.prevDistance = sensorDistance\n\n    if (Math.abs(sensorDistance) > I_CUTOFF) this.integral = 0\n    else this.integral += sensorDistance * delta\n\n    let der = (sensorDistance - this.prevDistance) / delta\n    this.prevDistance = sensorDistance\n\n    return sensorDistance*P_TERM + this.integral*I_TERM + der*D_TERM\n  }\n}".trim()},MOTION_PROFILE_CONTROLLER:{name:"Motion Profile Controller",code:"\nconst CRUISE_VELOCITY = 200, MAX_ACCEL = 200, CORNER_TIME = CRUISE_VELOCITY / MAX_ACCEL;\nconst V_TERM = 0.0013, P_TERM = -0.004;\n\n// See https://youtu.be/8319J1BEHwM For more information on what this controller does.\n\nclass Controller {\n  constructor() { this.totalDistance = null; this.initialTime = null; }\n\n  getDesiredVelocityAndPosition(time) {\n    const cruiseDistance =\n      this.totalDistance - CRUISE_VELOCITY * CORNER_TIME\n    const cruiseTime = cruiseDistance / CRUISE_VELOCITY\n    const backCornerTime = CORNER_TIME + cruiseTime\n\n    let velocity\n    if (time < CORNER_TIME) {\n      velocity = (CRUISE_VELOCITY / CORNER_TIME) * time\n    } else if (time < backCornerTime) {\n      velocity = CRUISE_VELOCITY\n    } else {\n      velocity = Math.max(\n        (CRUISE_VELOCITY / CORNER_TIME) * (backCornerTime - time) +\n          CRUISE_VELOCITY,\n        0\n      );\n    }\n\n    let position;\n    if (time < CORNER_TIME) position = 0.5 * MAX_ACCEL * Math.pow(time, 2)\n    else if (time < backCornerTime)\n      position = 0.5 * MAX_ACCEL * Math.pow(CORNER_TIME, 2) + CRUISE_VELOCITY * (time - CORNER_TIME)\n    else if (time < backCornerTime + CORNER_TIME)\n      position =\n        0.5 * MAX_ACCEL * Math.pow(CORNER_TIME, 2) +\n        CRUISE_VELOCITY * cruiseTime +\n        CRUISE_VELOCITY * (time - backCornerTime) - 0.5 * MAX_ACCEL * Math.pow(time - backCornerTime, 2)\n    else position = this.totalDistance\n\n    console.log(time, position)\n    return {position, velocity}\n  }\n\n  step({sensorDistance, delta, time}) {\n    if (this.totalDistance === null) {\n      this.totalDistance = sensorDistance\n      this.initialTime = time\n    }\n\n    const {position, velocity} = this.getDesiredVelocityAndPosition((time - this.initialTime))\n    const error = (this.totalDistance - position) - sensorDistance\n    return V_TERM*velocity + P_TERM*error\n  }\n}\n".trim()}},A=(n(92),300),N={frictionCoef:-.001,maxTorque:6e-4,stuckPowerThresh:.05,stuckAngularVelocityThresh:.5},B={THREE_ROBOTS:{name:"Three Robots",config:[{powerCoef:1,color:"#ff0000"},{powerCoef:.9,color:"#00ff00"},{powerCoef:.8,color:"#0000ff"}]},SINGLE_ROBOT:{name:"Single Robot",config:[{powerCoef:1,color:"#FFA500"}]}},V=new Map(Object.values(B).map((function(e){return[e.name,e.config]}))),P=new Map(Object.values(L).map((function(e){return[e.name,e.code]})));function F(e,t){p.Body.applyForce(e,p.Vector.add(e.position,p.Vector.create(0,e.circleRadius)),p.Vector.create(-t,0)),p.Body.applyForce(e,p.Vector.add(e.position,p.Vector.create(0,-e.circleRadius)),p.Vector.create(t,0))}var W=function(e){var t=e.style,n=e.className,o=e.width,c=e.height,s=e.active,u=i.useState(!1),h=Object(l.a)(u,2),m=h[0],R=h[1],E=i.useState(1),T=Object(l.a)(E,2),j=T[0],b=T[1],x=i.useState(0),_=Object(l.a)(x,2),S=_[0],I=_[1],M=i.useState(L.NO_CONTROLLER),W=Object(l.a)(M,2),U=W[0],q=W[1],Y=i.useState(),z=Object(l.a)(Y,2),X=z[0],G=z[1],H=i.useState(B.THREE_ROBOTS),J=Object(l.a)(H,2),K=J[0],Q=J[1],Z=i.useRef(0),$=i.useRef(null),ee=i.useRef(p.Engine.create()),te=i.useRef(),ne=i.useRef(),re=i.useRef(),ie=i.useRef(),oe=i.useRef(),ce=c/3,se=o;i.useEffect((function(){if($.current&&X&&j&&s){ee.current=p.Engine.create(),oe.current=new w(A),I(0),Z.current=0,R(!1);var e=function(e,t,n,r){var i={isStatic:!0,render:{fillStyle:null===r||void 0===r?void 0:r.walls},collisionFilter:{category:f.WALLS,mask:f.CARS}};p.World.add(e,[p.Bodies.rectangle(t/2,0,t,50,i),p.Bodies.rectangle(t/2,n,t,50,i),p.Bodies.rectangle(t,n/2,50,n,i),p.Bodies.rectangle(0,n/2,50,n,i)]);var o=p.Bodies.rectangle(.8*t,n/2,1,n,{isStatic:!0,id:d.SENSOR_B,collisionFilter:{category:f.SENSOR},render:{strokeStyle:"black",fillStyle:"transparent",lineWidth:1}});return p.World.add(e,o),{pointB:o}}(ee.current.world,se,ce).pointB;ie.current=e,re.current=[];var t,n=Object(C.a)(K.config);try{for(n.s();!(t=n.n()).done;){var r=t.value,i=r.powerCoef,o=r.color,c=y(150,ce-95,120,120,32,.2,{body:"".concat(o,"a0"),wheels:"".concat(o,"a0"),flag:"#ff4500a0",flagPole:"".concat(o,"a0")}),u=Object(l.a)(c,2),h=u[0],m=u[1];p.World.add(ee.current.world,h),re.current.push(Object(a.a)(Object(a.a)({},m),{},{positionWindow:new w(A),velocityWindow:new w(A),powerWindow:new w(A),motorBack:new D(N),motorFront:new D(N),controller:new X.factory,powerCoef:i,color:o}))}}catch(g){n.e(g)}finally{n.f()}return te.current=p.Render.create({canvas:$.current,engine:ee.current,options:{width:se,height:ce,wireframes:!1,showAngleIndicator:!0,background:"#d4d4d4"}}),p.Events.on(ee.current,"afterTick",(function(e){var t=e.timestamp;return I(t)})),p.Render.lookAt(te.current,{min:{x:0,y:0},max:{x:se,y:ce}}),p.Render.world(te.current),ne.current=p.Runner.create(),function(){ne.current&&(p.Runner.stop(ne.current),ne.current=void 0)}}}),[$,ee,te,se,ce,K,j,s,X]),i.useEffect((function(){if(ne.current&&ee.current&&m&&s)return p.Runner.start(ne.current,ee.current),function(){return p.Runner.stop(ne.current)}}),[ne,ee,m,s]),i.useEffect((function(){if(te.current&&oe.current&&re.current&&ie.current&&Z.current<S&&(p.Render.world(te.current),Z.current+0<S)){Z.current=S;var e=S-(oe.current.recent()||0);oe.current.addData(S);var t,n=Object(C.a)(re.current);try{for(n.s();!(t=n.n()).done;){var r=t.value,i=r.wheelBack,o=r.wheelFront,c=r.motorBack,s=r.motorFront,a=r.controller,l=r.body,u=r.positionWindow,d=r.velocityWindow,h=r.powerWindow,f=r.powerCoef,m=ie.current.position.x-l.position.x,g=u.recent()?-(m-u.recent())/(e/1e3):0;u.addData(m),d.addData(g);var v=Math.min(1,Math.max(-1,a.step({sensorDistance:m,delta:e/1e3,time:S/1e3,sensorVelocity:g})))*f;h.addData(v);var O=s.step(e,o.angularVelocity,v),y=c.step(e,i.angularVelocity,v);F(o,O),F(i,y)}}catch(R){n.e(R)}finally{n.f()}}}),[S]);var ae=i.useMemo((function(){if(oe.current&&re.current){var e=oe.current.values();return{timeDomain:e.length>2&&e[e.length-1]>500?[e[0],e[e.length-1]]:[0,500],position:re.current.map((function(t){var n=t.positionWindow,r=t.color;return{data:n.values().map((function(t,n){return{x:e[n],y:t}})),color:r}})),velocity:re.current.map((function(t){var n=t.velocityWindow,r=t.color;return{data:n.values().map((function(t,n){return{x:e[n],y:t}})),color:r}})),power:re.current.map((function(t){var n=t.powerWindow,r=t.color;return{data:n.values().map((function(t,n){return{x:e[n],y:t}})),color:r}}))}}return{timeDomain:[0,500],position:[],velocity:[],power:[]}}),[Z.current]),le={text:{fontSize:"1.2em",fill:"#d4d4d4"},title:{fontSize:"1.1em",fill:"#d4d4d4"}};return Object(r.jsxs)("div",{className:"robot-sim-container",style:Object(a.a)({width:o,height:c},t),children:[Object(r.jsx)("canvas",{className:n,ref:$,width:o,height:ce,style:{gridArea:"canvas"}}),Object(r.jsxs)("div",{style:{display:"flex",flexDirection:"column",gridArea:"editor",overflowY:"auto"},children:[Object(r.jsx)(k,{onCodeUpdate:function(e){return G({factory:e})},initialCode:U.code,style:{flexGrow:1}}),Object(r.jsxs)("div",{style:{display:"flex",alignContent:"center"},children:[Object(r.jsx)(O.a.Control,{as:"select",size:"lg",style:{width:"auto",marginRight:"0.4em"},value:U.name,onChange:function(e){return q({name:e.target.value,code:P.get(e.target.value)})},children:Array.from(P.keys()).map((function(e){return Object(r.jsx)("option",{children:e},e)}))}),Object(r.jsx)(O.a.Control,{as:"select",size:"lg",style:{width:"auto",marginRight:"0.4em"},value:K.name,onChange:function(e){return Q({name:e.target.value,config:V.get(e.target.value)})},children:Array.from(V.keys()).map((function(e){return Object(r.jsx)("option",{children:e},e)}))}),Object(r.jsx)(v.a,{variant:"danger",size:"lg",onClick:function(){return b(j+1)},style:{marginRight:"0.4em"},children:"Reload"}),m?Object(r.jsx)(v.a,{variant:"warning",size:"lg",onClick:function(){R(!1)},children:"Pause"}):Object(r.jsx)(v.a,{variant:"success",size:"lg",onClick:function(){R(!0)},children:"Play"})]})]}),Object(r.jsxs)(g.d,{xDomain:ae.timeDomain,yDomain:[-1.1,1.1],width:o/5,height:c/3*2,margin:{left:65},dontCheckIfEmpty:!0,children:[Object(r.jsx)(g.a,{}),ae.power.map((function(e,t){var n=e.data,i=e.color;return Object(r.jsx)(g.b,{data:n,color:i},t)})),Object(r.jsx)(g.c,{style:le,title:"Time (ms)",tickTotal:5}),Object(r.jsx)(g.e,{style:le,title:"Power"})]}),Object(r.jsxs)(g.d,{xDomain:ae.timeDomain,yDomain:[-400,o-200],width:o/5,height:c/3*2,margin:{left:65},dontCheckIfEmpty:!0,children:[Object(r.jsx)(g.a,{}),ae.position.map((function(e,t){var n=e.data,i=e.color;return Object(r.jsx)(g.b,{data:n,color:i},t)})),Object(r.jsx)(g.c,{style:le,title:"Time (ms)",tickTotal:5}),Object(r.jsx)(g.e,{style:le,title:"Distance (px)"})]}),Object(r.jsxs)(g.d,{xDomain:ae.timeDomain,yDomain:[-600,1e3],width:o/5,height:c/3*2,margin:{left:65},dontCheckIfEmpty:!0,children:[Object(r.jsx)(g.a,{}),ae.velocity.map((function(e,t){var n=e.data,i=e.color;return Object(r.jsx)(g.b,{data:n,color:i},t)})),Object(r.jsx)(g.c,{style:le,title:"Time (ms)",tickTotal:5}),Object(r.jsx)(g.e,{style:le,title:"Velocity (px/s)"})]})]})};function U(){return Object(r.jsx)(u,{children:function(e){var t=e.width,n=e.height;return Object(r.jsx)(W,{width:t,height:n,active:!0})}})}s.a.render(Object(r.jsx)(o.a.StrictMode,{children:Object(r.jsx)(U,{})}),document.getElementById("root"))}},[[94,1,2]]]);
//# sourceMappingURL=main.31a50d74.chunk.js.map