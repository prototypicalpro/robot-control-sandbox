(this["webpackJsonpdootcamp-robotics"]=this["webpackJsonpdootcamp-robotics"]||[]).push([[0],{56:function(e,t,n){},85:function(e,t,n){},86:function(e,t,n){},87:function(e,t,n){"use strict";n.r(t);var i=n(3),r=n(1),o=n.n(r),s=n(45),c=n.n(s),a=(n(56),n(57),n(8)),l=n(6);function u(e){var t=e.children,n=e.style,o=e.className,s=r.useState(),c=Object(l.a)(s,2),u=c[0],d=c[1],h=r.useRef(null);return r.useEffect((function(){if(h.current){var e=h.current.getBoundingClientRect();d({width:e.width,height:e.height})}}),[d]),Object(i.jsx)("div",{ref:h,style:Object(a.a)({width:"100%",height:"100%"},n),className:o,children:u?t(u):null})}var d,h,f,m,C=n(30),v=n(2),p=(n(58),n(4)),O=n(22);function R(e,t,n,i,r,o,s){var c=.5*-n+20,a=.5*n-20,l=.5*n-20,u=v.Body.nextGroup(!1),d=v.Composite.create({label:"Car"}),h=v.Bodies.rectangle(e,t,n,i,{collisionFilter:{category:f.CARS,mask:f.WALLS,group:u},density:1e-4,render:{fillStyle:null===s||void 0===s?void 0:s.body}});v.Body.rotate(h,Math.PI);var m=v.Bodies.circle(e+c,t+l,r,{collisionFilter:{category:f.CARS,mask:f.WALLS},friction:o,render:{fillStyle:null===s||void 0===s?void 0:s.wheels}}),C=v.Bodies.circle(e+a,t+l,r,{collisionFilter:{category:f.CARS,mask:f.WALLS},friction:o,render:{fillStyle:null===s||void 0===s?void 0:s.wheels}}),p=v.Constraint.create({bodyB:h,pointB:{x:c,y:l},bodyA:m,stiffness:1,length:0,render:{visible:!1}}),O=v.Constraint.create({bodyB:h,pointB:{x:a,y:l},bodyA:C,stiffness:1,length:0,render:{visible:!1}});return v.Composite.add(d,h),v.Composite.add(d,m),v.Composite.add(d,C),v.Composite.add(d,p),v.Composite.add(d,O),[d,{body:h,wheelBack:m,wheelFront:C}]}(h=d||(d={}))[h.SENSOR_B=v.Common.nextId()]="SENSOR_B",(m=f||(f={}))[m.WALLS=v.Body.nextCategory()]="WALLS",m[m.CARS=v.Body.nextCategory()]="CARS",m[m.SENSOR=v.Body.nextCategory()]="SENSOR";var y=n(48),E=n(20),T=n(21),g=n(31),b=n.n(g),j=function(){function e(t){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[];Object(E.a)(this,e),this.size=void 0,this.initial=void 0,this.curDenque=void 0,this.size=t,this.initial=Object(y.a)(n),this.curDenque=new b.a(n)}return Object(T.a)(e,[{key:"addData",value:function(e){this.curDenque.push(e),this.curDenque.length>=this.size&&this.curDenque.shift()}},{key:"values",value:function(){return this.curDenque.toArray()}},{key:"recent",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0;return this.curDenque.peekAt(this.curDenque.length-e-1)}},{key:"get",value:function(e){return this.curDenque.peekAt(e)}},{key:"reset",value:function(){this.curDenque=new b.a(this.initial)}},{key:"count",value:function(){return this.curDenque.length}}]),e}(),w=function(){function e(t){var n=t.maxTorque,i=t.stuckPowerThresh,r=t.stuckAngularVelocityThresh,o=t.frictionCoef;Object(E.a)(this,e),this.maxTorque=void 0,this.stuckPowerThresh=void 0,this.stuckAngularVelocityThresh=void 0,this.frictionCoef=void 0,this.maxTorque=n,this.stuckPowerThresh=i,this.stuckAngularVelocityThresh=r,this.frictionCoef=o}return Object(T.a)(e,[{key:"step",value:function(e,t,n){var i=t*this.frictionCoef;return(Math.abs(t)>=this.stuckAngularVelocityThresh||Math.abs(n)>=this.stuckPowerThresh)&&(i+=n*this.maxTorque),i*e}}]),e}(),D=n(47),x=n.n(D),_=n(32),I=n.n(_),S=(n(82),n(83),n(84),n(85),"\nclass Controller {\n  constructor() {\n\n  }\n\n  step(sensorDistance, time, delta) {\n    return 1\n  }\n}".trim());function M(e){var t=e.initialCode,n=void 0===t?S:t,o=e.onCodeUpdate,s=e.style,c=void 0===s?{}:s,u=r.useState(n),d=Object(l.a)(u,2),h=d[0],f=d[1],m=r.useState(),C=Object(l.a)(m,2),v=C[0],p=C[1];return r.useEffect((function(){var e;try{var t=new(e=Function('"use strict"; '.concat(h,"; return Controller;"))());if(!(t instanceof e))throw new Error("Not a class");if(!(t.step instanceof Function))throw new Error("No step() function on class")}catch(n){return void p(n.toString().split("\n")[0])}p(""),o(e)}),[h,o]),Object(i.jsxs)("div",{style:Object(a.a)({display:"flex",flexDirection:"column"},c),children:[Object(i.jsx)(x.a,{value:h,onValueChange:f,highlight:function(e){return I.a.highlight(e,I.a.languages.javascript,"javascript")},padding:10,className:"controller-editor-container",preClassName:"controller-editor-highlight"}),Object(i.jsx)("p",{style:{color:"#d4d4d4"},children:v})]})}n(86);var L=300,k={frictionCoef:-.001,maxTorque:6e-4,stuckPowerThresh:.05,stuckAngularVelocityThresh:.5};function A(e,t){v.Body.applyForce(e,v.Vector.add(e.position,v.Vector.create(0,e.circleRadius)),v.Vector.create(-t,0)),v.Body.applyForce(e,v.Vector.add(e.position,v.Vector.create(0,-e.circleRadius)),v.Vector.create(t,0))}var N=function(e){var t=e.style,n=e.className,o=e.width,s=e.height,c=e.cars,u=e.initialCode,h=e.active,m=r.useState(!1),y=Object(l.a)(m,2),E=y[0],T=y[1],g=r.useState(1),b=Object(l.a)(g,2),D=b[0],x=b[1],_=r.useState(0),I=Object(l.a)(_,2),S=I[0],N=I[1],B=r.useRef(),V=r.useRef(0),F=r.useRef(null),P=r.useRef(v.Engine.create()),W=r.useRef(),U=r.useRef(),q=r.useRef(),Y=r.useRef(),z=r.useRef(),X=s/3,G=o;r.useEffect((function(){if(F.current&&B.current&&D&&h){P.current=v.Engine.create(),z.current=new j(L),N(0),V.current=0,T(!1);var e=function(e,t,n,i){var r={isStatic:!0,render:{fillStyle:null===i||void 0===i?void 0:i.walls},collisionFilter:{category:f.WALLS,mask:f.CARS}};v.World.add(e,[v.Bodies.rectangle(t/2,0,t,50,r),v.Bodies.rectangle(t/2,n,t,50,r),v.Bodies.rectangle(t,n/2,50,n,r),v.Bodies.rectangle(0,n/2,50,n,r)]);var o=v.Bodies.rectangle(.8*t,n/2,1,n,{isStatic:!0,id:d.SENSOR_B,collisionFilter:{category:f.SENSOR},render:{strokeStyle:"black",fillStyle:"transparent",lineWidth:1}});return v.World.add(e,o),{pointB:o}}(P.current.world,G,X).pointB;Y.current=e,q.current=[];var t,n=Object(C.a)(c);try{for(n.s();!(t=n.n()).done;){var i=t.value,r=i.powerCoef,o=i.color,s=R(150,X-95,120,120,32,.2,{body:"".concat(o,"a0"),wheels:"".concat(o,"a0"),flag:"#ff4500a0",flagPole:"".concat(o,"a0")}),u=Object(l.a)(s,2),m=u[0],p=u[1];v.World.add(P.current.world,m),q.current.push(Object(a.a)(Object(a.a)({},p),{},{positionWindow:new j(L),velocityWindow:new j(L),powerWindow:new j(L),motorBack:new w(k),motorFront:new w(k),controller:new B.current,powerCoef:r,color:o}))}}catch(O){n.e(O)}finally{n.f()}return W.current=v.Render.create({canvas:F.current,engine:P.current,options:{width:G,height:X,wireframes:!1,showAngleIndicator:!0,background:"#d4d4d4"}}),v.Events.on(P.current,"afterTick",(function(e){var t=e.timestamp;return N(t)})),v.Render.lookAt(W.current,{min:{x:0,y:0},max:{x:G,y:X}}),v.Render.world(W.current),U.current=v.Runner.create(),function(){U.current&&(v.Runner.stop(U.current),U.current=void 0)}}}),[F,P,W,G,X,c,B,D,h]),r.useEffect((function(){if(U.current&&P.current&&E&&h)return v.Runner.start(U.current,P.current),function(){return v.Runner.stop(U.current)}}),[U,P,E,h]),r.useEffect((function(){if(W.current&&z.current&&q.current&&Y.current&&V.current<S&&(v.Render.world(W.current),V.current+0<S)){V.current=S;var e=S-(z.current.recent()||0);z.current.addData(S);var t,n=Object(C.a)(q.current);try{for(n.s();!(t=n.n()).done;){var i=t.value,r=i.wheelBack,o=i.wheelFront,s=i.motorBack,c=i.motorFront,a=i.controller,l=i.body,u=i.positionWindow,d=i.velocityWindow,h=i.powerWindow,f=i.powerCoef,m=Y.current.position.x-l.position.x,p=u.recent()?-(m-u.recent())/(e/1e3):0;u.addData(m),d.addData(p);var O=Math.min(1,Math.max(-1,a.step({sensorDistance:m,delta:e/1e3,time:S/1e3,sensorVelocity:p})))*f;h.addData(O);var R=c.step(e,o.angularVelocity,O),y=s.step(e,r.angularVelocity,O);A(o,R),A(r,y)}}catch(E){n.e(E)}finally{n.f()}}}),[S]);var H=r.useMemo((function(){var e,t;if((null===(e=z.current)||void 0===e||null===(t=e.count)||void 0===t?void 0:t.call(e))&&q.current){var n=z.current.values();return{timeDomain:[n[0],n[n.length-1]],position:q.current.map((function(e){var t=e.positionWindow,i=e.color;return{data:t.values().map((function(e,t){return{x:n[t],y:e}})),color:i}})),velocity:q.current.map((function(e){var t=e.velocityWindow,i=e.color;return{data:t.values().map((function(e,t){return{x:n[t],y:e}})),color:i}})),power:q.current.map((function(e){var t=e.powerWindow,i=e.color;return{data:t.values().map((function(e,t){return{x:n[t],y:e}})),color:i}}))}}}),[V.current]),J={text:{fontSize:"1.2em",fill:"#d4d4d4"},title:{fontSize:"1.1em",fill:"#d4d4d4"}};return Object(i.jsxs)("div",{className:"robot-sim-container",style:Object(a.a)({width:o,height:s},t),children:[Object(i.jsx)("canvas",{className:n,ref:F,width:o,height:X,style:{gridArea:"canvas"}}),Object(i.jsxs)("div",{style:{display:"flex",flexDirection:"column",gridArea:"editor",overflowY:"auto"},children:[Object(i.jsx)(M,{onCodeUpdate:function(e){return B.current=e},initialCode:u,style:{flexGrow:2}}),Object(i.jsxs)("span",{children:[Object(i.jsx)(O.a,{variant:"danger",size:"lg",onClick:function(){return x(D+1)},children:"Reload"})," ",E?Object(i.jsx)(O.a,{variant:"warning",size:"lg",onClick:function(){T(!1)},children:"Pause"}):Object(i.jsx)(O.a,{variant:"success",size:"lg",onClick:function(){T(!0)},children:"Play"})]})]}),H&&Object(i.jsxs)(p.d,{xDomain:H.timeDomain,yDomain:[-1.1,1.1],width:o/5,height:s/3*2,margin:{left:65},children:[Object(i.jsx)(p.a,{}),H.power.map((function(e,t){var n=e.data,r=e.color;return Object(i.jsx)(p.b,{data:n,color:r},t)})),Object(i.jsx)(p.c,{style:J,title:"Time (ms)",tickTotal:5}),Object(i.jsx)(p.e,{style:J,title:"Power"})]}),H&&Object(i.jsxs)(p.d,{xDomain:H.timeDomain,yDomain:[-400,o-200],width:o/5,height:s/3*2,margin:{left:65},children:[Object(i.jsx)(p.a,{}),H.position.map((function(e,t){var n=e.data,r=e.color;return Object(i.jsx)(p.b,{data:n,color:r},t)})),Object(i.jsx)(p.c,{style:J,title:"Time (ms)",tickTotal:5}),Object(i.jsx)(p.e,{style:J,title:"Distance (px)"})]}),H&&Object(i.jsxs)(p.d,{xDomain:H.timeDomain,yDomain:[-600,1e3],width:o/5,height:s/3*2,margin:{left:65},children:[Object(i.jsx)(p.a,{}),H.velocity.map((function(e,t){var n=e.data,r=e.color;return Object(i.jsx)(p.b,{data:n,color:r},t)})),Object(i.jsx)(p.c,{style:J,title:"Time (ms)",tickTotal:5}),Object(i.jsx)(p.e,{style:J,title:"Velocity (px/s)"})]})]})},B={NO_CONTROLLER:"\nclass Controller {\n  step() {\n    return 0\n  }\n}".trim(),TIME_CONTROLLER:"\nconst DRIVE_TIME = 1.8;\n\nclass Controller {\n  constructor() {\n    this.initialTime = null\n  }\n\n  step({time}) {\n    if (this.initialTime === null)\n      this.initialTime = time\n    const timeHasPassed = time - this.initialTime\n    if (timeHasPassed > DRIVE_TIME) return 0\n    else return 1\n  }\n}".trim(),BANG_BANG_CONTROLLER:"\nclass Controller {\n  step({sensorDistance}) {\n    if (sensorDistance > 0) return 1\n    else if (sensorDistance < 0) return -1\n    else return 0\n  }\n}".trim(),P_CONTROLLER:"\nconst P_TERM = 0;\n\nclass Controller {\n  step({sensorDistance}) {\n    return sensorDistance*P_TERM;\n  }\n}".trim(),PI_CONTROLLER:"\nconst P_TERM = 0.003;\nconst I_TERM = 0;\nconst I_CUTOFF = 0;\n\nclass Controller {\n  constructor() {\n    this.integral = 0\n  }\n\n  step({sensorDistance, delta}) {\n    if (Math.abs(sensorDistance) > I_CUTOFF) {\n      this.integral = 0\n    }\n    else {\n      this.integral += sensorDistance*delta\n    }\n\n    return sensorDistance*P_TERM + this.integral*I_TERM\n  }\n}".trim(),PID_CONTROLLER:"\nconst P_TERM = 0.003, I_TERM = 0.001, I_CUTOFF = 20, D_TERM = .003;\n\nclass Controller {\n  constructor() { this.integral = 0, this.prevDistance = null }\n\n  step({sensorDistance, delta}) {\n    if (this.prevDistance === null) this.prevDistance = sensorDistance\n\n    if (Math.abs(sensorDistance) > I_CUTOFF) this.integral = 0\n    else this.integral += sensorDistance * delta\n\n    let der = (sensorDistance - this.prevDistance) / delta\n    this.prevDistance = sensorDistance\n\n    return sensorDistance*P_TERM + this.integral*I_TERM + der*D_TERM\n  }\n}".trim(),MOTION_PROFILE_CONTROLLER:"\nconst CRUISE_VELOCITY = 200, MAX_ACCEL = 200, CORNER_TIME = CRUISE_VELOCITY / MAX_ACCEL;\nconst V_TERM = 0.0013, P_TERM = -0.004;\n\nclass Controller {\n  constructor() { this.totalDistance = null; this.initialTime = null; }\n\n  getDesiredVelocityAndPosition(time) {\n    const cruiseDistance =\n      this.totalDistance - CRUISE_VELOCITY * CORNER_TIME;\n    const cruiseTime = cruiseDistance / CRUISE_VELOCITY;\n    const backCornerTime = CORNER_TIME + cruiseTime;\n\n    let velocity;\n    if (time < CORNER_TIME) {\n      velocity = (CRUISE_VELOCITY / CORNER_TIME) * time;\n    } else if (time < backCornerTime) {\n      velocity = CRUISE_VELOCITY;\n    } else {\n      velocity = Math.max(\n        (CRUISE_VELOCITY / CORNER_TIME) * (backCornerTime - time) +\n          CRUISE_VELOCITY,\n        0\n      );\n    }\n\n    let position;\n    if (time < CORNER_TIME) position = 0.5 * MAX_ACCEL * Math.pow(time, 2);\n    else if (time < backCornerTime)\n      position = 0.5 * MAX_ACCEL * Math.pow(CORNER_TIME, 2) + CRUISE_VELOCITY * (time - CORNER_TIME);\n    else if (time < backCornerTime + CORNER_TIME)\n      position =\n        0.5 * MAX_ACCEL * Math.pow(CORNER_TIME, 2) +\n        CRUISE_VELOCITY * cruiseTime +\n        CRUISE_VELOCITY * (time - backCornerTime) - 0.5 * MAX_ACCEL * Math.pow(time - backCornerTime, 2);\n    else position = this.totalDistance\n\n    console.log(time, position)\n    return {position, velocity};\n  }\n\n  step({sensorDistance, delta, time}) {\n    if (this.totalDistance === null) {\n      this.totalDistance = sensorDistance;\n      this.initialTime = time;\n    }\n\n    const {position, velocity} = this.getDesiredVelocityAndPosition((time - this.initialTime));\n    const error = (this.totalDistance - position) - sensorDistance;\n    return V_TERM*velocity + P_TERM*error;\n  }\n}\n".trim()};function V(){return Object(i.jsx)(u,{children:function(e){var t=e.width,n=e.height;return Object(i.jsx)(N,{width:t,height:n,cars:[{powerCoef:1,color:"#FFA500"}],initialCode:B.NO_CONTROLLER,active:!0})}})}var F=function(e){e&&e instanceof Function&&n.e(3).then(n.bind(null,89)).then((function(t){var n=t.getCLS,i=t.getFID,r=t.getFCP,o=t.getLCP,s=t.getTTFB;n(e),i(e),r(e),o(e),s(e)}))};c.a.render(Object(i.jsx)(o.a.StrictMode,{children:Object(i.jsx)(V,{})}),document.getElementById("root")),F()}},[[87,1,2]]]);
//# sourceMappingURL=main.ad856f35.chunk.js.map