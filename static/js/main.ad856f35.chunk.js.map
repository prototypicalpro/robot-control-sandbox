{"version":3,"sources":["components/AutoSizer.tsx","robot-sim-utils/Constants.ts","robot-sim-utils/applyRobotEnvironment.ts","robot-sim-utils/DataWindow.ts","robot-sim-utils/MotorModel.ts","components/ControllerEditor.tsx","components/RobotSim.tsx","robot-sim-utils/Controllers.ts","components/Page.tsx","reportWebVitals.ts","index.tsx"],"names":["AutoSizer","children","style","className","React","widthHeight","setWidthHeight","elemRef","current","size","getBoundingClientRect","width","height","ref","OBJECT_ID","COLLISION_CATEGORY","makeCarComposite","xx","yy","wheelSize","wheelFriction","color","wheelAOffset","wheelBOffset","wheelYOffset","bodyGroup","Body","nextGroup","car","Composite","create","label","body","Bodies","rectangle","collisionFilter","category","CARS","mask","WALLS","group","density","render","fillStyle","rotate","Math","PI","wheelBack","circle","friction","wheels","wheelFront","axelBack","Constraint","bodyB","pointB","x","y","bodyA","stiffness","length","visible","axelFront","add","Common","nextId","nextCategory","DataWindow","initial","curDenque","this","Denque","data","push","shift","toArray","index","peekAt","MotorModel","maxTorque","stuckPowerThresh","stuckAngularVelocityThresh","frictionCoef","deltaTime","motorAngularVelocity","power","totalXForce","abs","CODE_DEFAULT","trim","ControllerEditor","initialCode","onCodeUpdate","code","setCode","error","setError","Controller","controllerInstance","Function","Error","step","e","toString","split","display","flexDirection","value","onValueChange","highlight","Prism","languages","javascript","padding","preClassName","WINDOW_SIZE","MOTOR_SETTINGS","driveWheel","wheel","force","applyForce","Vector","position","circleRadius","RobotSim","cars","active","simulationActive","setSimulationActive","simulationNumber","setSimulationNumber","curTick","setCurTick","factoryRef","proccessedTickRef","canvasRef","engineRef","Engine","rendererRef","runnerRef","wheelsRef","pointBRef","tickWindowRef","canvasHeight","canvasWidth","world","wallOpts","isStatic","walls","World","id","SENSOR_B","SENSOR","strokeStyle","lineWidth","applyRobotEnvironment","powerCoef","flag","flagPole","carParts","positionWindow","velocityWindow","powerWindow","motorBack","motorFront","controller","Render","canvas","engine","options","wireframes","showAngleIndicator","background","Events","on","timestamp","lookAt","min","max","Runner","stop","undefined","start","delta","recent","addData","dist","velocity","sensorDistance","time","sensorVelocity","frontPower","angularVelocity","backPower","res","count","tickVal","values","timeDomain","map","i","axisStyle","text","fontSize","fill","title","gridArea","overflowY","factory","flexGrow","Button","variant","onClick","xDomain","yDomain","margin","left","tickTotal","Controllers","NO_CONTROLLER","TIME_CONTROLLER","BANG_BANG_CONTROLLER","P_CONTROLLER","PI_CONTROLLER","PID_CONTROLLER","MOTION_PROFILE_CONTROLLER","Page","reportWebVitals","onPerfEntry","then","getCLS","getFID","getFCP","getLCP","getTTFB","ReactDOM","StrictMode","document","getElementById"],"mappings":"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","file":"static/js/main.ad856f35.chunk.js","sourcesContent":["import * as React from 'react';\n\ntype WidthHeight = {\n  width: number;\n  height: number;\n};\n\nexport default function AutoSizer({\n  children,\n  style,\n  className\n}: {\n  children: (size: WidthHeight) => React.ReactNode;\n  style?: React.CSSProperties;\n  className?: string;\n}) {\n  const [widthHeight, setWidthHeight] = React.useState<WidthHeight>();\n  const elemRef = React.useRef<HTMLDivElement>(null);\n\n  React.useEffect(() => {\n    if (elemRef.current) {\n      const size = elemRef.current.getBoundingClientRect();\n      setWidthHeight({width: size.width, height: size.height});\n    }\n  }, [setWidthHeight]);\n\n  return (\n    <div\n      ref={elemRef}\n      style={{width: '100%', height: '100%', ...style}}\n      className={className}\n    >\n      {widthHeight ? children(widthHeight) : null}\n    </div>\n  );\n}\n","import {Common, Body} from 'matter-js';\n\nexport enum OBJECT_ID {\n  SENSOR_B = Common.nextId()\n}\n\nexport enum COLLISION_CATEGORY {\n  WALLS = Body.nextCategory(),\n  CARS = Body.nextCategory(),\n  SENSOR = Body.nextCategory()\n}\n","import {World, Bodies, Body, Composite, Constraint} from 'matter-js';\nimport {OBJECT_ID, COLLISION_CATEGORY} from './Constants';\n\n// const NO_DENSITY = 1e-30;\n\n/**\n * Creates a composite with simple car setup of bodies and constraints.\n *\n * @param {number} xx\n * @param {number} yy\n * @param {number} width\n * @param {number} height\n * @param {number} wheelSize\n * @returns {composite} A new composite car body\n */\nexport function makeCarComposite(\n  xx: number,\n  yy: number,\n  width: number,\n  height: number,\n  wheelSize: number,\n  wheelFriction: number,\n  color?: {\n    flag?: string;\n    body?: string;\n    wheels?: string;\n    flagPole?: string;\n  }\n): [Composite, {body: Body; wheelBack: Body; wheelFront: Body}] {\n  const wheelBase = 20,\n    wheelAOffset = -width * 0.5 + wheelBase,\n    wheelBOffset = width * 0.5 - wheelBase,\n    wheelYOffset = width * 0.5 - wheelBase;\n  // flagXOffset = width * -0.5,\n  // flagYOffset = height * -0.5;\n  const bodyGroup = Body.nextGroup(false);\n\n  const car = Composite.create({label: 'Car'});\n  const body = Bodies.rectangle(xx, yy, width, height, {\n    collisionFilter: {\n      category: COLLISION_CATEGORY.CARS,\n      mask: COLLISION_CATEGORY.WALLS,\n      group: bodyGroup\n    },\n    density: 0.0001,\n    render: {\n      fillStyle: color?.body\n    }\n  });\n\n  Body.rotate(body, Math.PI);\n\n  const wheelBack = Bodies.circle(\n    xx + wheelAOffset,\n    yy + wheelYOffset,\n    wheelSize,\n    {\n      collisionFilter: {\n        category: COLLISION_CATEGORY.CARS,\n        mask: COLLISION_CATEGORY.WALLS\n      },\n      friction: wheelFriction,\n      render: {\n        fillStyle: color?.wheels\n      }\n    }\n  );\n\n  const wheelFront = Bodies.circle(\n    xx + wheelBOffset,\n    yy + wheelYOffset,\n    wheelSize,\n    {\n      collisionFilter: {\n        category: COLLISION_CATEGORY.CARS,\n        mask: COLLISION_CATEGORY.WALLS\n      },\n      friction: wheelFriction,\n      render: {\n        fillStyle: color?.wheels\n      }\n    }\n  );\n\n  const axelBack = Constraint.create({\n    bodyB: body,\n    pointB: {x: wheelAOffset, y: wheelYOffset},\n    bodyA: wheelBack,\n    stiffness: 1,\n    length: 0,\n    render: {\n      visible: false\n    }\n  });\n\n  const axelFront = Constraint.create({\n    bodyB: body,\n    pointB: {x: wheelBOffset, y: wheelYOffset},\n    bodyA: wheelFront,\n    stiffness: 1,\n    length: 0,\n    render: {\n      visible: false\n    }\n  });\n\n  // const particleRadius = 5;\n  // const rowCount = 5;\n  // const flagPole = Composites.softBody(\n  //   xx + flagXOffset - particleRadius,\n  //   yy + flagYOffset - particleRadius * (2 * rowCount - 1),\n  //   2,\n  //   rowCount,\n  //   0,\n  //   0,\n  //   true,\n  //   particleRadius,\n  //   {\n  //     render: {\n  //       visible: true,\n  //       fillStyle: color?.flagPole\n  //     },\n  //     density: 0.001,\n  //     slop: 0.005,\n  //     collisionFilter: {\n  //       category: COLLISION_CATEGORY.CARS,\n  //       mask: COLLISION_CATEGORY.WALLS,\n  //       group: bodyGroup\n  //     }\n  //   },\n  //   {\n  //     stiffness: 0.5\n  //   }\n  // );\n\n  // const leftFlagMountPoint = flagPole.bodies[flagPole.bodies.length - 2];\n  // const rightFlagMountPoint = flagPole.bodies[flagPole.bodies.length - 1];\n\n  // const flagBodyLeft = Constraint.create({\n  //   bodyB: body,\n  //   pointB: {x: flagXOffset, y: flagYOffset},\n  //   bodyA: leftFlagMountPoint,\n  //   stiffness: 1,\n  //   length: 0\n  // });\n\n  // const flagBodyRight = Constraint.create({\n  //   bodyB: body,\n  //   pointB: {x: flagXOffset + 2 * particleRadius, y: flagYOffset},\n  //   bodyA: rightFlagMountPoint,\n  //   stiffness: 1,\n  //   length: 0\n  // });\n\n  // const flagRadius = (4 * particleRadius) / Math.sqrt(3);\n  // const flagTriangle = Bodies.polygon(\n  //   xx + flagXOffset - 2 * particleRadius - 2,\n  //   yy + flagYOffset - particleRadius * (rowCount + 1),\n  //   3,\n  //   flagRadius,\n  //   {\n  //     density: NO_DENSITY,\n  //     collisionFilter: {\n  //       category: COLLISION_CATEGORY.CARS,\n  //       mask: COLLISION_CATEGORY.WALLS,\n  //       group: bodyGroup\n  //     },\n  //     render: {\n  //       fillStyle: color?.flag\n  //     }\n  //   }\n  // );\n\n  // const flagMount = Constraint.create({\n  //   bodyB: flagPole.bodies[2],\n  //   pointB: {x: 0, y: 0},\n  //   bodyA: flagTriangle,\n  //   pointA: {x: flagRadius / 2, y: 0},\n  //   stiffness: 0.9\n  // });\n\n  Composite.add(car, body);\n  Composite.add(car, wheelBack);\n  Composite.add(car, wheelFront);\n  Composite.add(car, axelBack);\n  Composite.add(car, axelFront);\n  // Composite.add(car, flagPole);\n  // Composite.add(car, flagBodyLeft);\n  // Composite.add(car, flagBodyRight);\n  // Composite.add(car, flagTriangle);\n  // Composite.add(car, flagMount);\n\n  return [\n    car,\n    {\n      body,\n      wheelBack,\n      wheelFront\n    }\n  ];\n}\n\nexport function applyRobotEnvironment(\n  world: World,\n  width: number,\n  height: number,\n  color?: {\n    walls?: string;\n  }\n) {\n  // walls\n  const wallOpts = {\n    isStatic: true,\n    render: {fillStyle: color?.walls},\n    collisionFilter: {\n      category: COLLISION_CATEGORY.WALLS,\n      mask: COLLISION_CATEGORY.CARS\n    }\n  };\n  World.add(world, [\n    // walls\n    Bodies.rectangle(width / 2, 0, width, 50, wallOpts),\n    Bodies.rectangle(width / 2, height, width, 50, wallOpts),\n    Bodies.rectangle(width, height / 2, 50, height, wallOpts),\n    Bodies.rectangle(0, height / 2, 50, height, wallOpts)\n  ]);\n  // create the destination point\n  const pointB = Bodies.rectangle(width * 0.8, height / 2, 1, height, {\n    isStatic: true,\n    id: OBJECT_ID.SENSOR_B,\n    collisionFilter: {\n      category: COLLISION_CATEGORY.SENSOR\n    },\n    render: {\n      strokeStyle: 'black',\n      fillStyle: 'transparent',\n      lineWidth: 1\n    }\n  });\n  World.add(world, pointB);\n\n  return {\n    pointB\n  };\n}\n","import Denque from 'denque';\n\nexport default class DataWindow<Data> {\n  private readonly size: number;\n  private readonly initial: Data[];\n  private curDenque: Denque<Data>;\n\n  constructor(size: number, initial: Data[] = []) {\n    this.size = size;\n    this.initial = [...initial];\n    this.curDenque = new Denque(initial);\n  }\n\n  addData(data: Data) {\n    this.curDenque.push(data);\n    if (this.curDenque.length >= this.size) this.curDenque.shift();\n  }\n\n  values(): readonly Data[] {\n    return this.curDenque.toArray();\n  }\n\n  recent(index: number = 0): Data {\n    return this.curDenque.peekAt(this.curDenque.length - index - 1) as Data;\n  }\n\n  get(index: number): Data {\n    return this.curDenque.peekAt(index) as Data;\n  }\n\n  reset() {\n    this.curDenque = new Denque(this.initial);\n  }\n\n  count(): number {\n    return this.curDenque.length;\n  }\n}\n","export default class MotorModel {\n  private readonly maxTorque: number;\n  private readonly stuckPowerThresh: number;\n  private readonly stuckAngularVelocityThresh: number;\n  private readonly frictionCoef: number;\n\n  constructor({\n    maxTorque,\n    stuckPowerThresh,\n    stuckAngularVelocityThresh,\n    frictionCoef\n  }: {\n    maxTorque: number;\n    stuckPowerThresh: number;\n    stuckAngularVelocityThresh: number;\n    frictionCoef: number;\n  }) {\n    this.maxTorque = maxTorque;\n    this.stuckPowerThresh = stuckPowerThresh;\n    this.stuckAngularVelocityThresh = stuckAngularVelocityThresh;\n    this.frictionCoef = frictionCoef;\n  }\n\n  step(deltaTime: number, motorAngularVelocity: number, power: number) {\n    // apply a force opposite to the direction the robot is currently moving\n    // this simulates the \"internal friction\" of the motors\n    let totalXForce = motorAngularVelocity * this.frictionCoef;\n    // if the power is under a certain threshold and the robot is \"stopped\",\n    // the motor stalls and we stop applying any force\n    if (\n      Math.abs(motorAngularVelocity) >= this.stuckAngularVelocityThresh ||\n      Math.abs(power) >= this.stuckPowerThresh\n    ) {\n      totalXForce += power * this.maxTorque;\n    }\n    // return the force * time\n    return totalXForce * deltaTime;\n  }\n}\n","import * as React from 'react';\nimport Editor from 'react-simple-code-editor';\nimport Prism from 'prismjs';\nimport 'prism-themes/themes/prism-vsc-dark-plus.css';\nimport 'prismjs/components/prism-clike';\nimport 'prismjs/components/prism-javascript';\nimport {ControllerFactory} from '../robot-sim-utils/Controller';\nimport './ControllerEditor.css';\n\nconst CODE_DEFAULT = `\nclass Controller {\n  constructor() {\n\n  }\n\n  step(sensorDistance, time, delta) {\n    return 1\n  }\n}`.trim();\n\nexport default function ControllerEditor({\n  initialCode = CODE_DEFAULT,\n  onCodeUpdate,\n  style = {}\n}: {\n  onCodeUpdate: (code: ControllerFactory) => void;\n  initialCode?: string;\n  style?: React.CSSProperties;\n}) {\n  const [code, setCode] = React.useState(initialCode);\n  const [error, setError] = React.useState<string>();\n\n  React.useEffect(() => {\n    let Controller;\n    try {\n      // I know I know\n      // eslint-disable-next-line no-new-func\n      Controller = Function(`\"use strict\"; ${code}; return Controller;`)();\n      const controllerInstance = new Controller();\n      if (!(controllerInstance instanceof Controller))\n        throw new Error('Not a class');\n      if (!(controllerInstance.step instanceof Function))\n        throw new Error('No step() function on class');\n    } catch (e) {\n      setError(e.toString().split('\\n')[0]);\n      return;\n    }\n    setError('');\n    onCodeUpdate(Controller as ControllerFactory);\n  }, [code, onCodeUpdate]);\n\n  return (\n    <div\n      style={{\n        display: 'flex',\n        flexDirection: 'column',\n        ...style\n      }}\n    >\n      <Editor\n        value={code}\n        onValueChange={setCode}\n        highlight={code =>\n          Prism.highlight(code, Prism.languages.javascript, 'javascript')\n        }\n        padding={10}\n        className=\"controller-editor-container\"\n        preClassName=\"controller-editor-highlight\"\n      />\n      <p style={{color: '#d4d4d4'}}>{error}</p>\n    </div>\n  );\n}\n","import * as React from 'react';\nimport {Engine, Render, World, Events, Body, Vector, Runner} from 'matter-js';\nimport '../../node_modules/react-vis/dist/style.css';\nimport {\n  XYPlot,\n  XAxis,\n  YAxis,\n  HorizontalGridLines,\n  LineSeriesCanvas\n} from 'react-vis';\nimport Button from 'react-bootstrap/Button';\nimport {\n  applyRobotEnvironment,\n  makeCarComposite\n} from '../robot-sim-utils/applyRobotEnvironment';\nimport DataWindow from '../robot-sim-utils/DataWindow';\nimport MotorModel from '../robot-sim-utils/MotorModel';\nimport {Controller, ControllerFactory} from '../robot-sim-utils/Controller';\nimport ControllerEditor from './ControllerEditor';\nimport './RobotSim.css';\n\nconst CAR_SCALE = 0.8;\nconst WINDOW_SIZE = 300;\nconst GRAPH_TICK_WAIT = 0;\nconst MOTOR_SETTINGS = {\n  frictionCoef: -0.001,\n  maxTorque: 0.0006,\n  stuckPowerThresh: 0.05,\n  stuckAngularVelocityThresh: 0.5\n};\n\nfunction driveWheel(wheel: Body, force: number) {\n  Body.applyForce(\n    wheel,\n    Vector.add(wheel.position, Vector.create(0, wheel.circleRadius)),\n    Vector.create(-force, 0)\n  );\n  Body.applyForce(\n    wheel,\n    Vector.add(\n      wheel.position,\n      Vector.create(0, -(wheel.circleRadius as number))\n    ),\n    Vector.create(force, 0)\n  );\n}\n\nconst RobotSim: React.FunctionComponent<{\n  width: number;\n  height: number;\n  cars: {\n    powerCoef: number;\n    color: string;\n  }[];\n  initialCode: string;\n  style?: React.CSSProperties;\n  className?: string;\n  active?: boolean;\n}> = ({style, className, width, height, cars, initialCode, active}) => {\n  const [simulationActive, setSimulationActive] = React.useState(false);\n  const [simulationNumber, setSimulationNumber] = React.useState(1);\n  const [curTick, setCurTick] = React.useState(0);\n  const factoryRef = React.useRef<ControllerFactory>();\n  const proccessedTickRef = React.useRef<number>(0);\n  const canvasRef = React.useRef<HTMLCanvasElement>(null);\n  const engineRef = React.useRef(Engine.create());\n  const rendererRef = React.useRef<Render>();\n  const runnerRef = React.useRef<Runner>();\n  const wheelsRef = React.useRef<\n    {\n      wheelFront: Body;\n      wheelBack: Body;\n      body: Body;\n      positionWindow: DataWindow<number>;\n      velocityWindow: DataWindow<number>;\n      powerWindow: DataWindow<number>;\n      motorFront: MotorModel;\n      motorBack: MotorModel;\n      controller: Controller;\n      powerCoef: number;\n      color: string;\n    }[]\n  >();\n  const pointBRef = React.useRef<Body>();\n  const tickWindowRef = React.useRef<DataWindow<DOMHighResTimeStamp>>();\n\n  const canvasHeight = height / 3;\n  const canvasWidth = width;\n\n  // setup engine and world\n  React.useEffect(() => {\n    if (canvasRef.current && factoryRef.current && simulationNumber && active) {\n      // reset the engine\n      engineRef.current = Engine.create();\n      // reset the processed tick and current tick\n      tickWindowRef.current = new DataWindow(WINDOW_SIZE);\n      setCurTick(0);\n      proccessedTickRef.current = 0;\n      setSimulationActive(false);\n      // generate the environment\n      const {pointB} = applyRobotEnvironment(\n        engineRef.current.world,\n        canvasWidth,\n        canvasHeight\n      );\n      pointBRef.current = pointB;\n      // generate a number of cars\n      wheelsRef.current = [];\n      for (const {powerCoef, color} of cars) {\n        const [car, carParts] = makeCarComposite(\n          150,\n          canvasHeight - 95,\n          150 * CAR_SCALE,\n          150 * CAR_SCALE,\n          40 * CAR_SCALE,\n          0.2,\n          {\n            body: `${color}a0`,\n            wheels: `${color}a0`,\n            flag: '#ff4500a0',\n            flagPole: `${color}a0`\n          }\n        );\n        World.add(engineRef.current.world, car);\n        wheelsRef.current.push({\n          ...carParts,\n          positionWindow: new DataWindow(WINDOW_SIZE),\n          velocityWindow: new DataWindow(WINDOW_SIZE),\n          powerWindow: new DataWindow(WINDOW_SIZE),\n          motorBack: new MotorModel(MOTOR_SETTINGS),\n          motorFront: new MotorModel(MOTOR_SETTINGS),\n          controller: new factoryRef.current(),\n          powerCoef,\n          color\n        });\n      }\n      // generate a renderer\n      rendererRef.current = Render.create({\n        canvas: canvasRef.current,\n        engine: engineRef.current,\n        options: {\n          width: canvasWidth,\n          height: canvasHeight,\n          wireframes: false,\n          showAngleIndicator: true,\n          background: '#d4d4d4'\n          // showCollisions: true\n        } as any\n      });\n      // set react to tick with the engine\n      Events.on(engineRef.current, 'afterTick', ({timestamp}) =>\n        setCurTick(timestamp)\n      );\n      // fit the render viewport to the scene\n      Render.lookAt(rendererRef.current, {\n        min: {x: 0, y: 0},\n        max: {x: canvasWidth, y: canvasHeight}\n      });\n      // run the Renderer once for a start freeze frame\n      Render.world(rendererRef.current);\n      // start the physics runner\n      // we let it run independently because react is too slow to keep up\n      runnerRef.current = Runner.create();\n      // cleanup\n      return () => {\n        // stop the runner\n        if (runnerRef.current) {\n          Runner.stop(runnerRef.current);\n          runnerRef.current = undefined;\n        }\n      };\n    }\n  }, [\n    canvasRef,\n    engineRef,\n    rendererRef,\n    canvasWidth,\n    canvasHeight,\n    cars,\n    factoryRef,\n    simulationNumber,\n    active\n  ]);\n\n  // handle play/pause changes\n  React.useEffect(() => {\n    if (runnerRef.current && engineRef.current && simulationActive && active) {\n      Runner.start(runnerRef.current, engineRef.current);\n      return () => Runner.stop(runnerRef.current as Runner);\n    }\n  }, [runnerRef, engineRef, simulationActive, active]);\n\n  // handle ticks\n  React.useEffect(() => {\n    if (\n      rendererRef.current &&\n      tickWindowRef.current &&\n      wheelsRef.current &&\n      pointBRef.current &&\n      proccessedTickRef.current < curTick\n    ) {\n      // render the world\n      Render.world(rendererRef.current);\n      // every someodd ticks, update the graph\n      if (proccessedTickRef.current + GRAPH_TICK_WAIT < curTick) {\n        // indicate we have processed the next tick\n        proccessedTickRef.current = curTick;\n        // calculate vectors\n        const delta = curTick - (tickWindowRef.current.recent() || 0);\n        // update tick state\n        tickWindowRef.current.addData(curTick);\n        // update the model cars\n        for (const {\n          wheelBack,\n          wheelFront,\n          motorBack,\n          motorFront,\n          controller,\n          body,\n          positionWindow,\n          velocityWindow,\n          powerWindow,\n          powerCoef\n        } of wheelsRef.current) {\n          // calculate velocities and such\n          const dist = pointBRef.current.position.x - body.position.x;\n          const velocity = positionWindow.recent()\n            ? -(dist - positionWindow.recent()) / (delta / 1e3)\n            : 0;\n          // update other state\n          positionWindow.addData(dist);\n          velocityWindow.addData(velocity);\n          const rawPower = Math.min(\n            1,\n            Math.max(\n              -1,\n              controller.step({\n                sensorDistance: dist,\n                delta: delta / 1e3, // milliseconds to seconds\n                time: curTick / 1e3,\n                sensorVelocity: velocity\n              })\n            )\n          );\n          // run the controller\n          const power = rawPower * powerCoef;\n          powerWindow.addData(power);\n          // step the motors based on the values we just calculated\n          const frontPower = motorFront.step(\n            delta,\n            wheelFront.angularVelocity,\n            power\n          );\n          const backPower = motorBack.step(\n            delta,\n            wheelBack.angularVelocity,\n            power\n          );\n          // apply forces\n          driveWheel(wheelFront, frontPower);\n          driveWheel(wheelBack, backPower);\n        }\n      }\n    }\n  }, [curTick]);\n\n  // generate data by zipping the tickWindow with all the other properties\n  const res = React.useMemo(() => {\n    if (tickWindowRef.current?.count?.() && wheelsRef.current) {\n      const tickVal = tickWindowRef.current.values();\n      return {\n        timeDomain: [tickVal[0], tickVal[tickVal.length - 1]],\n        position: wheelsRef.current.map(({positionWindow, color}) => ({\n          data: positionWindow.values().map((y, i) => ({x: tickVal[i], y})),\n          color\n        })),\n        velocity: wheelsRef.current.map(({velocityWindow, color}) => ({\n          data: velocityWindow.values().map((y, i) => ({x: tickVal[i], y})),\n          color\n        })),\n        power: wheelsRef.current.map(({powerWindow, color}) => ({\n          data: powerWindow.values().map((y, i) => ({x: tickVal[i], y})),\n          color\n        }))\n      };\n    }\n    // eslint-disable-next-line react-hooks/exhaustive-deps\n  }, [proccessedTickRef.current]);\n\n  const axisStyle = {\n    text: {fontSize: '1.2em', fill: '#d4d4d4'},\n    title: {fontSize: '1.1em', fill: '#d4d4d4'}\n  };\n\n  return (\n    <div className=\"robot-sim-container\" style={{width, height, ...style}}>\n      <canvas\n        className={className}\n        ref={canvasRef}\n        width={width}\n        height={canvasHeight}\n        style={{gridArea: 'canvas'}}\n      />\n      <div\n        style={{\n          display: 'flex',\n          flexDirection: 'column',\n          gridArea: 'editor',\n          overflowY: 'auto'\n        }}\n      >\n        <ControllerEditor\n          onCodeUpdate={factory => (factoryRef.current = factory)}\n          initialCode={initialCode}\n          style={{flexGrow: 2}}\n        />\n        <span>\n          <Button\n            variant=\"danger\"\n            size=\"lg\"\n            onClick={() => setSimulationNumber(simulationNumber + 1)}\n          >\n            Reload\n          </Button>{' '}\n          {simulationActive ? (\n            <Button\n              variant=\"warning\"\n              size=\"lg\"\n              onClick={() => {\n                setSimulationActive(false);\n              }}\n            >\n              Pause\n            </Button>\n          ) : (\n            <Button\n              variant=\"success\"\n              size=\"lg\"\n              onClick={() => {\n                setSimulationActive(true);\n              }}\n            >\n              Play\n            </Button>\n          )}\n        </span>\n      </div>\n      {res && (\n        <XYPlot\n          xDomain={res.timeDomain}\n          yDomain={[-1.1, 1.1]}\n          width={width / 5}\n          height={(height / 3) * 2}\n          margin={{left: 65}}\n        >\n          <HorizontalGridLines />\n          {res.power.map(({data, color}, i) => (\n            <LineSeriesCanvas key={i} data={data} color={color} />\n          ))}\n          <XAxis style={axisStyle} title=\"Time (ms)\" tickTotal={5} />\n          <YAxis style={axisStyle} title=\"Power\" />\n        </XYPlot>\n      )}\n      {res && (\n        <XYPlot\n          xDomain={res.timeDomain}\n          yDomain={[-400, width - 200]}\n          width={width / 5}\n          height={(height / 3) * 2}\n          margin={{left: 65}}\n        >\n          <HorizontalGridLines />\n          {res.position.map(({data, color}, i) => (\n            <LineSeriesCanvas key={i} data={data} color={color} />\n          ))}\n          <XAxis style={axisStyle} title=\"Time (ms)\" tickTotal={5} />\n          <YAxis style={axisStyle} title=\"Distance (px)\" />\n        </XYPlot>\n      )}\n      {res && (\n        <XYPlot\n          xDomain={res.timeDomain}\n          yDomain={[-600, 1000]}\n          width={width / 5}\n          height={(height / 3) * 2}\n          margin={{left: 65}}\n        >\n          <HorizontalGridLines />\n          {res.velocity.map(({data, color}, i) => (\n            <LineSeriesCanvas key={i} data={data} color={color} />\n          ))}\n          <XAxis style={axisStyle} title=\"Time (ms)\" tickTotal={5} />\n          <YAxis style={axisStyle} title=\"Velocity (px/s)\" />\n        </XYPlot>\n      )}\n    </div>\n  );\n};\n\nexport default RobotSim;\n","const Controllers = {\n  NO_CONTROLLER: `\nclass Controller {\n  step() {\n    return 0\n  }\n}`.trim(),\n\n  TIME_CONTROLLER: `\nconst DRIVE_TIME = 1.8;\n\nclass Controller {\n  constructor() {\n    this.initialTime = null\n  }\n\n  step({time}) {\n    if (this.initialTime === null)\n      this.initialTime = time\n    const timeHasPassed = time - this.initialTime\n    if (timeHasPassed > DRIVE_TIME) return 0\n    else return 1\n  }\n}`.trim(),\n\n  BANG_BANG_CONTROLLER: `\nclass Controller {\n  step({sensorDistance}) {\n    if (sensorDistance > 0) return 1\n    else if (sensorDistance < 0) return -1\n    else return 0\n  }\n}`.trim(),\n\n  P_CONTROLLER: `\nconst P_TERM = 0;\n\nclass Controller {\n  step({sensorDistance}) {\n    return sensorDistance*P_TERM;\n  }\n}`.trim(),\n\n  PI_CONTROLLER: `\nconst P_TERM = 0.003;\nconst I_TERM = 0;\nconst I_CUTOFF = 0;\n\nclass Controller {\n  constructor() {\n    this.integral = 0\n  }\n\n  step({sensorDistance, delta}) {\n    if (Math.abs(sensorDistance) > I_CUTOFF) {\n      this.integral = 0\n    }\n    else {\n      this.integral += sensorDistance*delta\n    }\n\n    return sensorDistance*P_TERM + this.integral*I_TERM\n  }\n}`.trim(),\n\n  PID_CONTROLLER: `\nconst P_TERM = 0.003, I_TERM = 0.001, I_CUTOFF = 20, D_TERM = .003;\n\nclass Controller {\n  constructor() { this.integral = 0, this.prevDistance = null }\n\n  step({sensorDistance, delta}) {\n    if (this.prevDistance === null) this.prevDistance = sensorDistance\n\n    if (Math.abs(sensorDistance) > I_CUTOFF) this.integral = 0\n    else this.integral += sensorDistance * delta\n\n    let der = (sensorDistance - this.prevDistance) / delta\n    this.prevDistance = sensorDistance\n\n    return sensorDistance*P_TERM + this.integral*I_TERM + der*D_TERM\n  }\n}`.trim(),\n\n  MOTION_PROFILE_CONTROLLER: `\nconst CRUISE_VELOCITY = 200, MAX_ACCEL = 200, CORNER_TIME = CRUISE_VELOCITY / MAX_ACCEL;\nconst V_TERM = 0.0013, P_TERM = -0.004;\n\nclass Controller {\n  constructor() { this.totalDistance = null; this.initialTime = null; }\n\n  getDesiredVelocityAndPosition(time) {\n    const cruiseDistance =\n      this.totalDistance - CRUISE_VELOCITY * CORNER_TIME;\n    const cruiseTime = cruiseDistance / CRUISE_VELOCITY;\n    const backCornerTime = CORNER_TIME + cruiseTime;\n\n    let velocity;\n    if (time < CORNER_TIME) {\n      velocity = (CRUISE_VELOCITY / CORNER_TIME) * time;\n    } else if (time < backCornerTime) {\n      velocity = CRUISE_VELOCITY;\n    } else {\n      velocity = Math.max(\n        (CRUISE_VELOCITY / CORNER_TIME) * (backCornerTime - time) +\n          CRUISE_VELOCITY,\n        0\n      );\n    }\n\n    let position;\n    if (time < CORNER_TIME) position = 0.5 * MAX_ACCEL * Math.pow(time, 2);\n    else if (time < backCornerTime)\n      position = 0.5 * MAX_ACCEL * Math.pow(CORNER_TIME, 2) + CRUISE_VELOCITY * (time - CORNER_TIME);\n    else if (time < backCornerTime + CORNER_TIME)\n      position =\n        0.5 * MAX_ACCEL * Math.pow(CORNER_TIME, 2) +\n        CRUISE_VELOCITY * cruiseTime +\n        CRUISE_VELOCITY * (time - backCornerTime) - 0.5 * MAX_ACCEL * Math.pow(time - backCornerTime, 2);\n    else position = this.totalDistance\n\n    console.log(time, position)\n    return {position, velocity};\n  }\n\n  step({sensorDistance, delta, time}) {\n    if (this.totalDistance === null) {\n      this.totalDistance = sensorDistance;\n      this.initialTime = time;\n    }\n\n    const {position, velocity} = this.getDesiredVelocityAndPosition((time - this.initialTime));\n    const error = (this.totalDistance - position) - sensorDistance;\n    return V_TERM*velocity + P_TERM*error;\n  }\n}\n`.trim()\n};\n\nexport default Controllers;\n","import * as React from 'react';\nimport AutoSizer from './AutoSizer';\nimport RobotSim from './RobotSim';\nimport Controllers from '../robot-sim-utils/Controllers';\n\nexport default function Page() {\n  // TODO: detect resize?\n  return (\n    <AutoSizer>\n      {({width, height}) => (\n        <RobotSim\n          width={width}\n          height={height}\n          cars={[{powerCoef: 1, color: '#FFA500'}]}\n          initialCode={Controllers.NO_CONTROLLER}\n          active={true}\n        />\n      )}\n    </AutoSizer>\n  );\n}\n","function reportWebVitals(onPerfEntry?: () => void): void {\n  if (onPerfEntry && onPerfEntry instanceof Function) {\n    import('web-vitals').then(({getCLS, getFID, getFCP, getLCP, getTTFB}) => {\n      getCLS(onPerfEntry);\n      getFID(onPerfEntry);\n      getFCP(onPerfEntry);\n      getLCP(onPerfEntry);\n      getTTFB(onPerfEntry);\n    });\n  }\n}\n\nexport default reportWebVitals;\n","import React from 'react';\nimport ReactDOM from 'react-dom';\nimport './index.css';\nimport 'bootstrap/dist/css/bootstrap.min.css';\nimport Page from './components/Page';\nimport reportWebVitals from './reportWebVitals';\n\nReactDOM.render(\n  <React.StrictMode>\n    <Page />\n  </React.StrictMode>,\n  document.getElementById('root')\n);\n\n// If you want to start measuring performance in your app, pass a function\n// to log results (for example: reportWebVitals(console.log))\n// or send to an analytics endpoint. Learn more: https://bit.ly/CRA-vitals\nreportWebVitals();\n"],"sourceRoot":""}